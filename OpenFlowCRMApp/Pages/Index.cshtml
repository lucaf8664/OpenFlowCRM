@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <div class="container border" style="padding:20px">
        <form method="post">
            <div class="form-group row">
                <div class="col-2">
                    <label asp-for="Utente.UserName">
                        User Name
                    </label>
                </div>
                <div class="col-5">
                    <input id="username" type="text" asp-for="Utente.UserName" />
                </div>
            </div>
            <div class="form-group row">
                <div class="col-2">
                    <label asp-for="Utente.Password">
                        Password
                    </label>
                </div>
                <div class="col-5">
                    <input id="password" type="password" asp-for="Utente.Password" />
                </div>
            </div>
            <div class="form-group row">
                <div class="col-2">
                    <input type="submit" class="btn btn-primary" value="Log in" />
                </div>
            </div>
        </form>
    </div>
    
    
    

    <script>
        // Add an event listener to the login form's submit button
        function UserLogin() {
            // Prevent the default form submission behavior

            var n = document.getElementById("username").value;
            var p = document.getElementById("password").value;

            var loginDto = {
                username: n,
                password: p
            }


            $.ajax({
                url: "/api/Auth/login", // endpoint
                type: "POST",
                data: JSON.stringify(loginDto),
                contentType: "application/json",
                success: function (result) {
                    var token = result.token; // assuming the JSON response contains a property named "token"

                    window.location.pathname = "/App/Home"
                },
                error: function (xhr, textStatus, error) {
                    alert("Autenticazione fallita!");
                    alert(textStatus);
                    console.log(xhr.responseText);
                }
            });

        };
    </script>

</div>
